From a8899be95ad3f3b64d158543e00aae31d3ff3796 Mon Sep 17 00:00:00 2001
From: Florin Postolache <florin.postolache80@gmail.com>
Date: Thu, 27 Oct 2022 12:35:43 +0300
Subject: [PATCH] Modify ftello-unflushed-append source to work with uktest

Signed-off-by: Florin Postolache <florin.postolache80@gmail.com>
---
 src/regression/ftello-unflushed-append.c | 16 ++++++----------
 1 file changed, 6 insertions(+), 10 deletions(-)

diff --git a/src/regression/ftello-unflushed-append.c b/src/regression/ftello-unflushed-append.c
index 5473719..1b2c02a 100644
--- a/src/regression/ftello-unflushed-append.c
+++ b/src/regression/ftello-unflushed-append.c
@@ -6,17 +6,16 @@
 #include <stdlib.h>
 #include <string.h>
 #include <unistd.h>
-#include "test.h"
+#include <uk/test.h>
 
 #define ASSERT(c) do { \
 	errno = 0; \
-	if (!(c)) \
-		t_error("%s failed (errno: %s)\n", #c, strerror(errno)); \
+	UK_TEST_ASSERT((c)); \
 } while(0)
 
-int main(void)
+UK_TESTCASE(uk_libc_testsuite, ftello_unflushed_append_tests)
 {
-	char tmp[] = "/tmp/testsuite-XXXXXX";
+	char tmp[] = "/testsuite-XXXXXX";
 	int fd;
 	FILE *f;
 	off_t off;
@@ -30,15 +29,12 @@ int main(void)
 	if (f) {
 		ASSERT(fwrite("efg", 1, 3, f) == 3);
 		ASSERT((off = ftello(f)) != -1);
-		if (off != 7)
-			t_error("ftello is broken before flush: got %lld, want 7\n", (long long)off);
+		UK_TEST_ASSERT(off == 7);
 		ASSERT(fflush(f) == 0);
 		ASSERT((off = ftello(f)) != -1);
-		if (off != 7)
-			t_error("ftello is broken after flush: got %lld, want 7\n", (long long)off);
+		UK_TEST_ASSERT(off == 7);
 		ASSERT(fclose(f) == 0);
 	}
 	if (fd > 2)
 		ASSERT(unlink(tmp) == 0);
-	return t_status;
 }
-- 
2.25.1

