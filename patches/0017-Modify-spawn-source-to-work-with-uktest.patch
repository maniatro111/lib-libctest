From d893bd85bd64a40f9d15fba1ebce71b0ca813086 Mon Sep 17 00:00:00 2001
From: Florin Postolache <florin.postolache80@gmail.com>
Date: Tue, 11 Oct 2022 09:25:23 +0300
Subject: [PATCH] Modify spawn source to work with uktest

---
 src/functional/spawn.c | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/src/functional/spawn.c b/src/functional/spawn.c
index 4ce9772..3d15ec1 100644
--- a/src/functional/spawn.c
+++ b/src/functional/spawn.c
@@ -8,17 +8,17 @@
 #include <string.h>
 #include <spawn.h>
 #include <sys/wait.h>
-#include "test.h"
+#include <uk/test.h>//"test.h"
 
-#define TEST(f, x) (void)( \
-	(r = (f)) == (x) || \
-	t_error("%s failed, got %d want %d\n", #f, r, x) )
+#define TEST(f, x) UK_TEST_ASSERT((r = (f)) == (x))//(void)( \
+//	(r = (f)) == (x) || \
+//	t_error("%s failed, got %d want %d\n", #f, r, x) )
 
-#define TEST_E(f) (void)( \
-	(errno = 0), (f) || \
-	t_error("%s failed (errno = %d \"%s\")\n", #f, errno, strerror(errno)) )
+#define TEST_E(f) UK_TEST_EXPECT_ZERO((f))//(void)( \
+//	(errno = 0), (f) || \
+//	t_error("%s failed (errno = %d \"%s\")\n", #f, errno, strerror(errno)) )
 
-int main(void)
+UK_TESTCASE(uk_libc_testsuite, spawn_tests)//int main(void)
 {
 	int r;
 	char foo[10];
@@ -38,5 +38,5 @@ int main(void)
 	TEST(read(p[0], foo, sizeof foo), 6);
 	close(p[0]);
 	TEST(posix_spawn_file_actions_destroy(&fa), 0);
-	return t_status;
+//	return t_status;
 }
-- 
2.25.1

