From dce727a4bf34bde0c731cb134f7e6196f6d990df Mon Sep 17 00:00:00 2001
From: Florin Postolache <florin.postolache80@gmail.com>
Date: Thu, 27 Oct 2022 13:09:47 +0300
Subject: [PATCH] Modify iconv-roundtrips source to work with uktest

Signed-off-by: Florin Postolache <florin.postolache80@gmail.com>
---
 src/regression/iconv-roundtrips.c | 15 +++++----------
 1 file changed, 5 insertions(+), 10 deletions(-)

diff --git a/src/regression/iconv-roundtrips.c b/src/regression/iconv-roundtrips.c
index 279d25b..fd75b47 100644
--- a/src/regression/iconv-roundtrips.c
+++ b/src/regression/iconv-roundtrips.c
@@ -2,9 +2,9 @@
 // fix iconv conversions for iso88592-iso885916
 #include <iconv.h>
 #include <string.h>
-#include "test.h"
+#include <uk/test.h>
 
-int main(void)
+UK_TESTCASE(uk_libc_testsuite, iconv_roundtrips_tests)
 {
 	static char *test_charsets[] = {
 		"iso-8859-1",
@@ -44,16 +44,11 @@ int main(void)
 			&(char *){u8buf}, &(size_t){u8len},
 			&(char *){buf}, &(size_t){sizeof buf});
 
-		if (r1) t_error("got %d converting from %s\n", r1, test_charsets[i]);
-		if (r2) t_error("got %d converting back to %s\n", r2, test_charsets[i]);
-
-		if (memcmp(all_codepoints, buf, sizeof buf)) {
-			t_error("round trip corrupted %s characters\n", test_charsets[i]);
-		}
+		UK_TEST_EXPECT_SNUM_NQ(r1, (size_t) -1);
+		UK_TEST_EXPECT_SNUM_NQ(r2, (size_t) -1);
+		UK_TEST_EXPECT_ZERO(memcmp(all_codepoints, buf, sizeof buf));
 
 		iconv_close(there);
 		iconv_close(andback);
 	}
-
-	return t_status;
 }
-- 
2.25.1

